<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui">

  <h:head>
    <title>YumYum Ciencias - Detalles de puesto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="KLAN"></meta>
    <meta charset="utf-8"/>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyBlEYhBfp104jOYDy-TOhTYkSd8YBtkLFI" type="text/javascript"></script>  
    <style>
        .nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus
        { background-color: #ddd !important; }
    </style>
  </h:head>
    <h:body style="margin-top: 60px">
        
         <h1>Agrega un Puesto</h1> <br/>

        <h:form id="agregaPuesto" enctype="multipart/form-data">
            <ui:include src="index/opciones.xhtml"/>
            <h:panelGrid columns="2" cellpadding="5">
                  <h:outputLabel value="Nombre del Puesto: "/>
                  <p:inputText value="#{agregarPuesto.nombre}" p:placeholder="Nombre del Puesto" required="true" id="puesto" size="15"/>
                  
                  <h:outputLabel for="multiple" value="Comida que vende: "/>
                  <p:selectCheckboxMenu id="multiple" value="#{agregarPuesto.comida_seleccionada}" label="Comida"
                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px" >
                      <f:selectItems value="#{agregarPuesto.encuentraComida()}"/>
                  </p:selectCheckboxMenu>
                 
                  <h:outputLabel value="Descripción: "/>
                  <p:inputTextarea value="#{agregarPuesto.descripcion}" rows="6" cols="33" />
                
                  <h:outputLabel value="Imagen del Puesto: "/>
                        <p:growl id="imagen" showDetail="true" />
                        <p:fileUpload value="#{agregarPuesto.archivo}" mode="simple" skinSimple="true"/>
                 
            </h:panelGrid>
            
            <div>
            <h:outputLabel value="Ubicación: "/><br></br>
            <p:growl id="messages" showDetail="true" />
            <p:gmap id="gmap" center="19.324328359583355,-99.17934268712997" zoom="20"
                    type="roadmap" model="#{agregarPuesto.advancedModel}"
              style="width:25%;height:200px" onPointClick="handlePointClick(event);" widgetVar="map">
                <p:ajax event="overlaySelect" listener="#{agregarPuesto.onMarkerSelect}"/>
            </p:gmap>
   
            <p:dialog widgetVar="dlg" showEffect="fade">
              <h:form prependId="false">
                <h:panelGrid columns="2">
                  <h:outputLabel for="titulo" value="Nombre:" />
                  <p:inputText id="titulo" value="#{agregarPuesto.nombre}" />
                  <f:facet name="footer">
                      <p:commandButton value="Guardar" actionListener="#{agregarPuesto.addMarker()}" update=":messages" oncomplete="markerAddComplete()" />
                    <p:commandButton value="Cancelar" onclick="return cancel()" />
                  </f:facet>
                </h:panelGrid>
                  <h:inputHidden id="lat" value="#{agregarPuesto.lat}" />
                  <h:inputHidden id="lng" value="#{agregarPuesto.lng}" />
              </h:form>
            </p:dialog>
            </div>
               
            
            
            <h:panelGrid columns="2">
                <p:commandButton value="Agregar" ajax="false" action="#{agregarPuesto.agregar()}"/>
                <p:commandButton value="Reset" update="agregaPuesto" process="@this"  >
                <p:resetInput target="agregaPuesto" />
                </p:commandButton>
            </h:panelGrid>
            
        </h:form>
         
    </h:body>
    
    <script type="text/javascript">
    var currentMarker = null;
    var insertado = 0;

    function handlePointClick(event) {
        if(insertado === 0) {
            if (currentMarker === null) {
              document.getElementById('lat').value = event.latLng.lat();
              document.getElementById('lng').value = event.latLng.lng();
              currentMarker = new google.maps.Marker({
                position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
              }); insertado = 1;
              PF('map').addOverlay(currentMarker);
              PF('dlg').show();
            }
        }
    }

    function markerAddComplete() {
      var title = document.getElementById('title');
      currentMarker.setTitle(title.value);
      title.value = "";
      currentMarker = null;
      PF('dlg').hide();
    }

    function cancel() {
      PF('dlg').hide();
      currentMarker.setMap(null);
      currentMarker = null;
      return false;
    }
  </script>
    
</html>
      
